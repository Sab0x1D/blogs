---
layout: default
title: 
page_num: 1
permalink: /
---

<link rel="stylesheet" href="{{ '/assets/css/theme.css' | relative_url }}">
<link rel="stylesheet" href="{{ '/assets/css/site.css'  | relative_url }}">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script defer src="{{ '/assets/js/theme.js' | relative_url }}"></script>
<script defer src="{{ '/assets/js/site.js'  | relative_url }}"></script>

<section class="home">
  <div class="container">
    {%- assign coll = site.listings | sort: 'date' | reverse -%}
    {%- assign excerpt_limit = site.excerpt_chars | default: 220 -%}

{%- assign hero = coll | first -%}
{%- assign hero_title = hero.pretty_title | default: hero.title -%}
{%- assign hero_thumb = hero.thumb | default: site.default_thumb -%}

<h2 class="section-title">LATEST POST</h2>
<section class="hero-row" aria-label="Latest post">
  <!-- Entire hero is ONE link -->
  <a class="hero-card" href="{{ hero.url | relative_url }}">
    <div class="hero-grid">
      <!-- Left: image -->
      <div class="hero-media">
        <img class="hero-img" src="{{ hero_thumb | relative_url }}" alt="{{ hero_title }}">
        <span class="meta-top">{{ hero.date | date: "%d %b %Y" }}</span>
      </div>
      <!-- Right: copy (no nested links) -->
      <div class="hero-copy">
        <h1 class="hero-title">{{ hero_title }}</h1>
        {%- if hero.excerpt -%}
          <p class="hero-excerpt">{{ hero.excerpt | strip_html | truncate: excerpt_limit }}</p>
        {%- endif -%}
      </div>
    </div>
  </a>
</section>


    {%- comment -%}
      FEATURED: newest posts with `featured: true`, then top up with newest non-featured.
    {%- endcomment -%}
    {%- assign featured_ids = "" -%}
    {%- assign featured_printed = 0 -%}
    {%- assign manual = coll | where_exp: 'p', 'p.featured == true' -%}

    <h2 class="section-title">FEATURED</h2>
    <section class="featured-row" aria-label="Featured posts">
      {%- for p in manual -%}
        {%- if featured_printed < 4 -%}
          <a class="card card--sm" href="{{ p.url | relative_url }}">
            <div class="media">
              <img class="thumb" src="{{ (p.thumb | default: site.default_thumb) | relative_url }}" alt="{{ p.title }}">
              <span class="meta-top">{{ p.date | date: "%d %b %Y" }}</span>
            </div>
            <div class="body"><h3 class="title">{{ p.title }}</h3></div>
          </a>
          {%- assign featured_ids = featured_ids | append: p.url | append: '|' -%}
          {%- assign featured_printed = featured_printed | plus: 1 -%}
        {%- endif -%}
      {%- endfor -%}

      {%- if featured_printed < 4 -%}
        {%- for p in coll -%}
          {%- if featured_printed < 4 and (featured_ids contains p.url) == false and p.featured != true -%}
            <a class="card card--sm" href="{{ p.url | relative_url }}">
              <div class="media">
                <img class="thumb" src="{{ (p.thumb | default: site.default_thumb) | relative_url }}" alt="{{ p.title }}">
                <span class="meta-top">{{ p.date | date: "%d %b %Y" }}</span>
              </div>
              <div class="body"><h3 class="title">{{ p.title }}</h3></div>
            </a>
            {%- assign featured_ids = featured_ids | append: p.url | append: '|' -%}
            {%- assign featured_printed = featured_printed | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}
    </section> 

    <!-- Previous posts: show all EXCEPT the 4 actually displayed in Featured, and the Hero -->
    <h2 class="section-title">PREVIOUS POSTS</h2>

    {%- assign page_size = 9 -%}
    {%- assign current   = page.page_num | plus: 0 -%}
    {%- if current <= 0 %}{% assign current = 1 %}{% endif %}

    {%- comment -%}
      Build list of previous posts (exclude the 4 displayed featured + the hero).
    {%- endcomment -%}
    {%- assign featured_list = coll | where_exp: 'p', 'p.featured == true' | slice: 0, 4 -%}
    {%- assign featured_urls = featured_list | map: 'url' -%}

    {%- assign previous = "" | split: "" -%}
    {%- for p in coll -%}
      {%- unless featured_urls contains p.url or p.url == hero.url -%}
        {%- assign previous = previous | push: p -%}
      {%- endunless -%}
    {%- endfor -%}

    {%- assign base_pages = previous.size | divided_by: page_size -%}
    {%- assign remainder  = previous.size | modulo: page_size -%}
    {%- assign total_pages = base_pages -%}
    {%- if remainder > 0 -%}{%- assign total_pages = base_pages | plus: 1 -%}{%- endif -%}

    {%- assign offset = page_size | times: current | minus: page_size -%}

    <!-- CHANGED: added id="posts-grid" so JS can append more cards -->
    <section id="posts-grid" class="grid" aria-label="Previous posts">
      {%- for p in previous offset: offset limit: page_size -%}
        <a class="card card--lg" href="{{ p.url | relative_url }}">
          <div class="media">
            <img class="thumb" src="{{ (p.thumb | default: site.default_thumb) | relative_url }}" alt="{{ p.title }}">
            <span class="meta-top">{{ p.date | date: "%d %b %Y" }}</span>
          </div>
          <div class="body">
            <h3 class="title">{{ p.title }}</h3>
            {%- if p.excerpt -%}
              <p class="excerpt">{{ p.excerpt | strip_html | truncate: excerpt_limit }}</p>
            {%- endif -%}
          </div>
        </a>
      {%- endfor -%}
    </section>

    {%- if total_pages > 1 -%}
      {%- assign prev_num = current | minus: 1 -%}
      {%- assign next_num = current | plus: 1 -%}

      {%- assign prev_href = '' -%}
      {%- if prev_num == 1 -%}
        {%- assign prev_href = '/' | relative_url -%}
      {%- elsif prev_num > 1 -%}
        {%- assign prev_href = '/page/' | append: prev_num | append: '/' | relative_url -%}
      {%- endif -%}

      {%- assign next_href = '' -%}
      {%- if next_num == 1 -%}
        {%- assign next_href = '/' | relative_url -%}
      {%- elsif next_num <= total_pages -%}
        {%- assign next_href = '/page/' | append: next_num | append: '/' | relative_url -%}
      {%- endif -%}

      <!-- CHANGED: replace old pager with "Read more" + noscript fallback -->
      <button
        id="load-more"
        class="btn-readmore"
        aria-label="Load more posts"
        data-baseurl="{{ site.baseurl }}"
        data-current-page="{{ current }}"
        data-total-pages="{{ total_pages }}"
      >
        Read more
      </button>

      <noscript>
        <nav class="pager noscript-only" aria-label="Pagination">
          <ul>
            <li>
              {%- if prev_href != '' -%}
                <a href="{{ prev_href }}">‹ Prev</a>
              {%- else -%}
                <span>‹ Prev</span>
              {%- endif -%}
            </li>
            <li><span>Page {{ current }} of {{ total_pages }}</span></li>
            <li>
              {%- if next_href != '' -%}
                <a href="{{ next_href }}">Next ›</a>
              {%- else -%}
                <span>Next ›</span>
              {%- endif -%}
            </li>
          </ul>
        </nav>
      </noscript>

      <!-- CHANGED: include the loader script -->
      <script type="module" src="{{ '/assets/js/load-more.js' | relative_url }}"></script>
    {%- endif -%}

    {% include topics-grid.html title='POPULAR TOPICS' %}
  </div>
</section>
