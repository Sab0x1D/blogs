---
layout: default
title: Blog Index
permalink: /blog-index/
---

<link rel="stylesheet" href="{{ '/assets/css/theme.css' | relative_url }}">
<link rel="stylesheet" href="{{ '/assets/css/site.css'  | relative_url }}">

<section class="home">
  <div class="container">
    <h2 class="section-title">BLOG INDEX</h2>

    <div style="display:flex;gap:10px;flex-wrap:wrap;margin:14px 0 18px 0;">
      <input id="bi-search" type="search" placeholder="Search title, month, year..."
         style="flex:1;min-width:240px;padding:10px 12px;border:1px solid var(--card-border);border-radius:12px;">
      <button id="bi-clear" type="button"
          style="padding:10px 12px;border:1px solid var(--card-border);border-radius:12px;background:var(--chip-bg);cursor:pointer;">
            Clear
      </button>
    </div>


    {%- assign items_sorted = site.listings | sort: "date" | reverse -%}
    {%- assign years = items_sorted | group_by_exp: "p", "p.date | date: '%Y'" -%}

    <section class="blog-tree" aria-label="Blog index by year and month">
      {%- for year in years -%}
        <details class="blog-tree__year" open>
          <summary class="blog-tree__summary">
            <span class="blog-tree__label">{{ year.name }}</span>
            <span class="blog-tree__count">{{ year.items | size }} posts</span>
          </summary>

          {%- assign months = year.items | group_by_exp: "p", "p.date | date: '%m'" -%}

          {%- for month in months -%}
            {%- assign month_name = month.items[0].date | date: "%B" -%}

            <details class="blog-tree__month">
              <summary class="blog-tree__summary blog-tree__summary--month">
                <span class="blog-tree__label">{{ month_name }}</span>
                <span class="blog-tree__count">{{ month.items | size }}</span>
              </summary>

              <ul class="blog-tree__list">
                {%- for post in month.items -%}
                  {%- assign thumb = post.thumb | default: site.default_thumb -%}
                  <li class="blog-tree__item"
                      data-title="{{ post.pretty_title | default: post.title | downcase | escape }}"
                      data-month="{{ post.date | date: '%B' | downcase | escape }}"
                      data-year="{{ post.date | date: '%Y' | escape }}">
                    <a class="blog-tree__link" href="{{ post.url | relative_url }}">
                      <span class="blog-tree__thumb">
                        <img
                          src="{{ thumb | relative_url }}"
                          alt=""
                          loading="lazy"
                          width="56"
                          height="56"
                        >
                      </span>

                      <span class="blog-tree__title">
                        {{ post.pretty_title | default: post.title }}
                        <span class="blog-tree__meta">{{ post.date | date: "%d %b %Y" }}</span>
                      </span>
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </details>
          {%- endfor -%}
        </details>
      {%- endfor -%}
    </section>
  </div>
</section>

<script>
(function(){
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
  const q = document.getElementById('bi-search');
  const clearBtn = document.getElementById('bi-clear');

  const items = $$('.blog-tree__item');
  const monthBlocks = $$('.blog-tree__month');
  const yearBlocks  = $$('.blog-tree__year');

  // Capture initial open/closed state so we can restore it after clearing search
  const initialMonthOpen = monthBlocks.map(m => m.open);
  const initialYearOpen  = yearBlocks.map(y => y.open);

  function norm(x){ return (x || '').toLowerCase().trim(); }

  function applyFilters(){
    const qv = norm(q && q.value);

    // Restore default open/closed state when search is cleared
    if (!qv) {
      monthBlocks.forEach((m, i) => { m.open = initialMonthOpen[i]; });
      yearBlocks.forEach((y, i) => { y.open = initialYearOpen[i]; });
    }

    // 1) Filter individual posts
    items.forEach(li => {
      const title = norm(li.dataset.title);
      const month = norm(li.dataset.month);
      const year  = norm(li.dataset.year);

      const ok = !qv || title.includes(qv) || month.includes(qv) || year.includes(qv);
      li.style.display = ok ? '' : 'none';
    });

    // 2) Hide month buckets with zero visible posts
    monthBlocks.forEach(m => {
      const visible = $$('.blog-tree__item', m).some(li => li.style.display !== 'none');
      m.style.display = visible ? '' : 'none';
      if (qv && visible) m.open = true;
    });

    // 3) Hide year buckets with zero visible months
    yearBlocks.forEach(y => {
      const visible = $$('.blog-tree__month', y).some(m => m.style.display !== 'none');
      y.style.display = visible ? '' : 'none';
      if (qv && visible) y.open = true;
    });
  }

  if (q) q.addEventListener('input', applyFilters);

  if (clearBtn) clearBtn.addEventListener('click', () => {
    if (q) q.value = '';
    applyFilters();
    if (q) q.focus();
  });

  applyFilters();
})();
</script>
