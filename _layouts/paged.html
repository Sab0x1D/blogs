---
layout: default
---

<link rel="stylesheet" href="{{ '/assets/css/theme.css' | relative_url }}">
<link rel="stylesheet" href="{{ '/assets/css/site.css'  | relative_url }}">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script defer src="{{ '/assets/js/theme.js' | relative_url }}"></script>
<script defer src="{{ '/assets/js/site.js'  | relative_url }}"></script>

<section class="home">
  <div class="container">
    {%- assign coll = site.listings | sort: 'date' | reverse -%}
    {%- assign excerpt_limit = site.excerpt_chars | default: 220 -%}

    <h2 class="section-title">PREVIOUS POSTS</h2>

    {%- comment -%} 4 actually displayed featured (newest) {%- endcomment -%}
    {%- assign featured_all  = coll | where: 'featured', true -%}
    {%- assign featured_list = featured_all | slice: 0, 4 -%}
    {%- assign featured_urls = featured_list | map: 'url' -%}

    {%- assign base_page_size = 6 -%}  {%- comment -%} homepage count {%- endcomment -%}
    {%- assign page_size      = 9 -%}  {%- comment -%} page 2+ count {%- endcomment -%}
    {%- assign current        = page.page_num | plus: 0 -%}
    {%- if current <= 0 %}{% assign current = 1 %}{% endif %}

    {%- comment -%}
      Build counts WITHOUT constructing arrays.
      previous_count = coll.size - featured_list.size
      total_pages = 1 + ceil(max(previous_count - 6, 0) / 9)
    {%- endcomment -%}
    {%- assign previous_count = coll.size | minus: featured_list.size -%}
    {%- assign remaining = previous_count | minus: base_page_size -%}
    {%- if remaining < 0 -%}{%- assign remaining = 0 -%}{%- endif -%}
    {%- assign add_pages = remaining | divided_by: page_size -%}
    {%- assign add_remainder = remaining | modulo: page_size -%}
    {%- assign total_pages = add_pages -%}
    {%- if add_remainder > 0 -%}{%- assign total_pages = total_pages | plus: 1 -%}{%- endif -%}
    {%- assign total_pages = total_pages | plus: 1 -%}

    {%- comment -%}
      Determine slice range for this page (within the "previous" stream):
      start_index = 0 for page 1 (but homepage handles that)
      For page >=2: start_index = 6 + (current-2)*9
      end_index   = start_index + 9 - 1
    {%- endcomment -%}
    {%- if current < 2 -%}
      {%- assign start_index = 0 -%}
    {%- else -%}
      {%- assign start_index = base_page_size | plus: page_size | times: (current | minus: 2) -%}
    {%- endif -%}
    {%- assign end_index = start_index | plus: page_size | minus: 1 -%}

    <section class="grid" aria-label="Previous posts">
      {%- assign shown = 0 -%}
      {%- assign idx   = 0 -%}
      {%- for p in coll -%}
        {%- unless featured_urls contains p.url -%}
          {%- if current >= 2 -%}
            {%- if idx >= start_index and idx <= end_index -%}
              <a class="card card--lg" href="{{ p.url | relative_url }}">
                <div class="media">
                  <img class="thumb" src="{{ (p.thumb | default: site.default_thumb) | relative_url }}" alt="{{ p.title }}">
                  <span class="meta-top">{{ p.date | date: "%d %b %Y" }}</span>
                </div>
                <div class="body">
                  <h3 class="title">{{ p.title }}</h3>
                  {%- if p.excerpt -%}
                    <p class="excerpt">{{ p.excerpt | strip_html | truncate: excerpt_limit }}</p>
                  {%- endif -%}
                </div>
              </a>
              {%- assign shown = shown | plus: 1 -%}
            {%- endif -%}
          {%- else -%}
            {# page_num 1 should never use this layout; homepage handles page 1 #}
          {%- endif -%}
          {%- assign idx = idx | plus: 1 -%}
        {%- endunless -%}
      {%- endfor -%}
    </section>

    {%- if total_pages > 1 -%}
      {%- assign prev_num = current | minus: 1 -%}
      {%- assign next_num = current | plus: 1 -%}

      {%- assign prev_href = '' -%}
      {%- if prev_num == 1 -%}
        {%- assign prev_href = '/' | relative_url -%}
      {%- elsif prev_num > 1 -%}
        {%- assign prev_href = '/page/' | append: prev_num | append: '/' | relative_url -%}
      {%- endif -%}

      {%- assign next_href = '' -%}
      {%- if next_num == 1 -%}
        {%- assign next_href = '/' | relative_url -%}
      {%- elsif next_num <= total_pages -%}
        {%- assign next_href = '/page/' | append: next_num | append: '/' | relative_url -%}
      {%- endif -%}

      <nav class="pager" aria-label="Pagination">
        <ul>
          <li>
            {%- if prev_href != '' -%}
              <a href="{{ prev_href }}">‹ Prev</a>
            {%- else -%}
              <span>‹ Prev</span>
            {%- endif -%}
          </li>
          <li><span>Page {{ current }} of {{ total_pages }}</span></li>
          <li>
            {%- if next_href != '' -%}
              <a href="{{ next_href }}">Next ›</a>
            {%- else -%}
              <span>Next ›</span>
            {%- endif -%}
          </li>
        </ul>
      </nav>
    {%- endif -%}
  </div>
</section>
